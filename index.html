<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calcolatore TFR vs Fondo Pensione</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #2563eb;
            --bg: #f8fafc;
            --card: #ffffff;
            --text: #1e293b;
        }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background: var(--bg); color: var(--text); padding: 20px; margin: 0; }
        .container { max-width: 800px; margin: 0 auto; background: var(--card); padding: 30px; border-radius: 12px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: var(--primary); margin-bottom: 30px; }
        
        .grid-inputs { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 20px; }
        .input-group { display: flex; flex-direction: column; }
        label { font-size: 0.9rem; font-weight: 600; margin-bottom: 5px; color: #64748b; }
        input { padding: 10px; border: 1px solid #cbd5e1; border-radius: 6px; font-size: 1rem; }
        
        .section-title { border-bottom: 2px solid #e2e8f0; padding-bottom: 5px; margin: 30px 0 15px 0; color: #334155; font-weight: bold; }
        
        button { width: 100%; padding: 15px; background: var(--primary); color: white; border: none; border-radius: 8px; font-size: 1.1rem; font-weight: bold; cursor: pointer; margin-top: 20px; }
        button:hover { background: #1d4ed8; }

        .results { display: none; margin-top: 40px; border-top: 1px solid #e2e8f0; padding-top: 20px; }
        .cards { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px; }
        .card { padding: 20px; background: #f1f5f9; border-radius: 10px; text-align: center; border: 2px solid transparent; }
        .card.winner { border-color: #10b981; background: #ecfdf5; }
        .big-num { font-size: 1.8rem; font-weight: 800; margin: 10px 0; color: var(--primary); }
        .card.winner .big-num { color: #059669; }
        .details { font-size: 0.85rem; color: #64748b; line-height: 1.6; }

        @media (max-width: 600px) { .cards { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

<div class="container">
    <h1>Calcolo TFR: Azienda vs Fondo</h1>

    <!-- INPUT PRINCIPALI -->
    <div class="section-title">1. Dati Anagrafici ed Economici</div>
    <div class="grid-inputs">
        <div class="input-group">
            <label>Età Attuale</label>
            <input type="number" id="eta" value="57">
        </div>
        <div class="input-group">
            <label>Età Pensionamento</label>
            <input type="number" id="eta_pensione" value="67">
        </div>
        <div class="input-group">
            <label>RAL Attuale (€)</label>
            <input type="number" id="ral" value="50000">
        </div>
        <div class="input-group">
            <label>TFR Pregresso (€)</label>
            <input type="number" id="tfr_pregresso" value="50000">
        </div>
    </div>

    <!-- PARAMETRI MODIFICABILI -->
    <div class="section-title">2. Parametri Rendimento e Tasse (Manovrabili)</div>
    <div class="grid-inputs">
        <div class="input-group">
            <label>Crescita Stipendio Annua (%)</label>
            <input type="number" id="crescita_ral" value="0" step="0.1">
        </div>
        <div class="input-group">
            <label>Rendimento Annuo TFR Azienda (%)</label>
            <input type="number" id="rend_az" value="2.85" step="0.01">
        </div>
        <div class="input-group">
            <label>Rendimento Annuo Fondo (%)</label>
            <input type="number" id="rend_fp" value="3.00" step="0.01">
        </div>
    </div>
    <div class="grid-inputs">
        <div class="input-group">
            <label>Aliquota Tasse Finale Azienda (%)</label>
            <input type="number" id="tax_az" value="28.00" step="0.1" title="Inserisci l'aliquota media IRPEF stimata">
        </div>
        <div class="input-group">
            <label>Aliquota Tasse Finale Fondo (%)</label>
            <input type="number" id="tax_fp" value="14.00" step="0.1" title="Inserisci aliquota media attesa (es. tra 15% e 9%)">
        </div>
    </div>

    <button onclick="calcola()">Calcola Risultato</button>

    <!-- RISULTATI -->
    <div class="results" id="results">
        <div class="cards">
            <div class="card" id="card_az">
                <h3>TFR in Azienda</h3>
                <div class="big-num" id="netto_az">€ 0</div>
                <div class="details">
                    Lordo Finale: <span id="lordo_az">€ 0</span><br>
                    Tasse Totali: <span id="tasse_az">€ 0</span>
                </div>
            </div>
            <div class="card" id="card_fp">
                <h3>Fondo Pensione</h3>
                <div class="big-num" id="netto_fp">€ 0</div>
                <div class="details">
                    Lordo Finale: <span id="lordo_fp">€ 0</span><br>
                    Tasse Totali: <span id="tasse_fp">€ 0</span>
                </div>
            </div>
        </div>
        <canvas id="chart"></canvas>
    </div>
</div>

<script>
    let myChart = null;

    function format(num) {
        return new Intl.NumberFormat('it-IT', { style: 'currency', currency: 'EUR', maximumFractionDigits: 0 }).format(num);
    }

    function calcola() {
        // Input Utente
        const eta = parseFloat(document.getElementById('eta').value);
        const eta_end = parseFloat(document.getElementById('eta_pensione').value);
        let ral = parseFloat(document.getElementById('ral').value);
        const tfr_start = parseFloat(document.getElementById('tfr_pregresso').value);

        // Parametri Tassi
        const rate_crescita_ral = parseFloat(document.getElementById('crescita_ral').value) / 100;
        const rate_rend_az = parseFloat(document.getElementById('rend_az').value) / 100;
        const rate_rend_fp = parseFloat(document.getElementById('rend_fp').value) / 100;
        
        // Parametri Tasse Finali
        const tax_rate_az = parseFloat(document.getElementById('tax_az').value) / 100;
        const tax_rate_fp = parseFloat(document.getElementById('tax_fp').value) / 100;

        // Costante
        const coeff_tfr = 0.0691; 

        // Loop di Calcolo
        let montante_az = tfr_start;
        let montante_fp = tfr_start;
        let anni = eta_end - eta;
        
        let labels = [];
        let data_az = [];
        let data_fp = [];

        // Aggiungiamo il punto di partenza (anno 0)
        labels.push(eta);
        data_az.push(montante_az);
        data_fp.push(montante_fp);

        for (let i = 1; i <= anni; i++) {
            // 1. Calcolo TFR maturato nell'anno corrente
            let tfr_anno = ral * coeff_tfr;

            // 2. Logica EXCEL UTENTE: (Capitale Pregresso + TFR Anno) * (1 + Rendimento)
            // Nota: Questa formula applica il rendimento ANCHE sul versamento appena fatto.
            montante_az = (montante_az + tfr_anno) * (1 + rate_rend_az);
            montante_fp = (montante_fp + tfr_anno) * (1 + rate_rend_fp);

            // Aggiornamento array grafico
            labels.push(eta + i);
            data_az.push(montante_az);
            data_fp.push(montante_fp);

            // Incremento RAL per anno successivo
            ral = ral * (1 + rate_crescita_ral);
        }

        // Calcolo Finale Tassazione (Manovrabile dall'utente)
        // Applico la tassa sul totale lordo accumulato per semplicità e coerenza con la richiesta "manovrabile"
        // Netto = Lordo - (Lordo * AliquotaInput)
        
        let tasse_az_tot = montante_az * tax_rate_az;
        let netto_az = montante_az - tasse_az_tot;

        let tasse_fp_tot = montante_fp * tax_rate_fp;
        let netto_fp = montante_fp - tasse_fp_tot;

        // --- OUTPUT ---
        document.getElementById('results').style.display = 'block';

        document.getElementById('lordo_az').innerText = format(montante_az);
        document.getElementById('tasse_az').innerText = format(tasse_az_tot);
        document.getElementById('netto_az').innerText = format(netto_az);

        document.getElementById('lordo_fp').innerText = format(montante_fp);
        document.getElementById('tasse_fp').innerText = format(tasse_fp_tot);
        document.getElementById('netto_fp').innerText = format(netto_fp);

        // Evidenzia Vincitore
        const cAz = document.getElementById('card_az');
        const cFp = document.getElementById('card_fp');
        cAz.className = 'card'; cFp.className = 'card'; // reset
        if (netto_fp > netto_az) cFp.classList.add('winner');
        else cAz.classList.add('winner');

        // Grafico
        const ctx = document.getElementById('chart').getContext('2d');
        if (myChart) myChart.destroy();
        myChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [
                    { label: 'Lordo Azienda', data: data_az, borderColor: '#ef4444', fill: false },
                    { label: 'Lordo Fondo Pensione', data: data_fp, borderColor: '#10b981', fill: false }
                ]
            },
            options: { responsive: true, interaction: { mode: 'index', intersect: false } }
        });
    }
</script>

</body>
</html>
